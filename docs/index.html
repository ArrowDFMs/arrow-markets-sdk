<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>arrow-sdk</title><meta name="description" content="Documentation for arrow-sdk"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">arrow-sdk</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>arrow-sdk </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#arrow-api" id="arrow-api" style="color: inherit; text-decoration: none;">
  <h1>Arrow API</h1>
</a>
<p>Arrow Markets has an API for interacting with its contract suite. This is due to the fact that we compute an option&#39;s price off-chain and therefore must pass it securely as a part of the transaction parameters. The transaction must be submitted by the deployer of the contracts.</p>
<p>There is an <code>arrow-sdk.ts</code> file in the repository that contains useful variables, objects, and functions, such as the API URL and the router contract. For reference, the scripts contained within the <code>./examples</code> folder make use of that file.</p>

<a href="#api-urls" id="api-urls" style="color: inherit; text-decoration: none;">
  <h2>API URLs</h2>
</a>
<p>The API can be accessed via <code>https://fuji-v2-api.arrow.markets/v1/&lt;ENDPOINT&gt;</code><br>The Fuji test network can be accessed via <code>https://api.avax-test.network/ext/bc/C/rpc</code></p>

<a href="#endpoints" id="endpoints" style="color: inherit; text-decoration: none;">
  <h2>Endpoints</h2>
</a>
<p>Estimate Option Price: <code>/estimate-option-price</code><br><code>POST</code> request<br><br>Inputs:</p>
<pre><code><span class="hl-2">Body</span><span class="hl-0">: {</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;ticker&quot;</span><span class="hl-0">, </span><span class="hl-4">// String to indicate a particular asset (&quot;AVAX&quot;, &quot;ETH&quot;, &quot;BTC&quot;, or &quot;LINK&quot;).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;expiration&quot;</span><span class="hl-0">, </span><span class="hl-4">// Date in &quot;MMDDYYYY&quot; format (e.g. &quot;01252022&quot; for January 25th, 2022).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;strike&quot;</span><span class="hl-0">, </span><span class="hl-4">// Price at which contract becomes active at expiration.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;contract_type&quot;</span><span class="hl-0">, </span><span class="hl-4">// 0 for call, 1 for put, 2 for call spread, and 3 for put spread.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;quantity&quot;</span><span class="hl-0">, </span><span class="hl-4">// Number of contracts desired in the order.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;price_history&quot;</span><span class="hl-0"> </span><span class="hl-4">// Price history of underlying asset in an array. We recommend requesting this data from https://api.coingecko.com/api/v3/coins/{crypto_id}/market_chart?vs_currency=usd&amp;days=84.</span><br/><span class="hl-0">}</span>
</code></pre>
<p>Outputs:</p>
<pre><code><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;option_price&quot;</span><span class="hl-0"> </span><span class="hl-4">// Current price of the option contract given the data from the &quot;price_history&quot; input.</span><br/><span class="hl-0">}</span>
</code></pre>
<p><br>Get Recommended Option: <code>/get-recommended-strike</code><br>Note: This currently only works with the speculation workflow. Hedging workflow is coming soon.<br><code>GET</code> request<br><br>Inputs:</p>
<pre><code><span class="hl-2">Params</span><span class="hl-0">: {</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;ticker&quot;</span><span class="hl-0">, </span><span class="hl-4">// String to indicate a particular asset (&quot;AVAX&quot;, &quot;ETH&quot;, &quot;BTC&quot;, or &quot;LINK&quot;).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;expiration&quot;</span><span class="hl-0">, </span><span class="hl-4">// Date in &quot;MMDDYYYY&quot; format (e.g. &quot;01252022&quot; for January 25th, 2022).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;forecast&quot;</span><span class="hl-0"> </span><span class="hl-4">// Forecasted price of the underlying asset (e.g. we might expect AVAX to reach $115, so we would pass 115)</span><br/><span class="hl-0">}</span>
</code></pre>
<p>Outputs:</p>
<pre><code><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;contract_type&quot;</span><span class="hl-0">, </span><span class="hl-4">// 0 for call, 1 for put, 2 for call spread, and 3 for put spread.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;greeks&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">        </span><span class="hl-3">&quot;delta&quot;</span><span class="hl-0">, </span><span class="hl-4">// How sensitive the price of this option is to changes in the price of the underlying.</span><br/><span class="hl-0">        </span><span class="hl-3">&quot;gamma&quot;</span><span class="hl-0">, </span><span class="hl-4">// How sensitive the price of this option is to reduction in the time to expiration on the scale of days.</span><br/><span class="hl-0">        </span><span class="hl-3">&quot;theta&quot;</span><span class="hl-5"> </span><span class="hl-4">// A measure of the sensitivity of the option&#39;s delta wrt changes in the underlying price.</span><br/><span class="hl-5">    },</span><br/><span class="hl-5">    </span><span class="hl-3">&quot;option_price&quot;</span><span class="hl-0">, </span><span class="hl-4">// Current price of the option contract.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;strike&quot;</span><span class="hl-5"> </span><span class="hl-4">// Price at which contract becomes active at expiration.</span><br/><span class="hl-5">}</span>
</code></pre>
<p><br>Submit Order: <code>/submit-order</code><br><code>POST</code> request</p>
<pre><code><span class="hl-2">Body</span><span class="hl-0">: {</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;buy_flag&quot;</span><span class="hl-0">, </span><span class="hl-4">// Boolean to indicate whether this is a buy (true) or sell (false).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;ticker&quot;</span><span class="hl-0">, </span><span class="hl-4">// String to indicate a particular asset (&quot;AVAX&quot;, &quot;ETH&quot;, &quot;BTC&quot;, or &quot;LINK&quot;).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;expiration&quot;</span><span class="hl-0">, </span><span class="hl-4">// Date in &quot;MMDDYYYY&quot; format (e.g. &quot;01252022&quot; for January 25th, 2022).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;strike&quot;</span><span class="hl-0">, </span><span class="hl-4">// Price at which contract becomes active at expiration.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;contract_type&quot;</span><span class="hl-0">, </span><span class="hl-4">// 0 for call, 1 for put, 2 for call spread, and 3 for put spread.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;quantity&quot;</span><span class="hl-0">, </span><span class="hl-4">// Number of contracts desired in the order.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;threshold_price&quot;</span><span class="hl-0">, </span><span class="hl-4">// Indication of the price the user is willing to pay (e.g. ethers.utils.parseUnits(priceWillingToPay, await usdc_e.decimals()).toString()).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;hashed_params&quot;</span><span class="hl-0">, </span><span class="hl-4">// Stringified hash of parameters.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;signature&quot;</span><span class="hl-0"> </span><span class="hl-4">// User&#39;s signature of the hashed parameters.</span><br/><span class="hl-0">}</span>
</code></pre>
<p>Note: For ease of use, we may update the <code>threshold_price</code> parameter to ask for a javascript number instead of a parsed ethers BigNumber.<br><br>Outputs:</p>
<pre><code><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;tx_hash&quot;</span><span class="hl-0">, </span><span class="hl-4">// Hash of the transaction that was submitted upon successful API request.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;execution_price&quot;</span><span class="hl-0"> </span><span class="hl-4">// Price that the user was charged per option contract in the order.</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#arrow-contracts" id="arrow-contracts" style="color: inherit; text-decoration: none;">
  <h1>Arrow Contracts</h1>
</a>
<p>There are several smart contracts that comprise the Arrow Markets smart contract suite, however, due to the architecture of the deployment, only a few are necessary for developing composable products and features.</p>
<p>The important contracts are the ArrowRouter, ArrowRegistry, and ArrowEvents contracts.</p>

<a href="#arrow-event-specifications" id="arrow-event-specifications" style="color: inherit; text-decoration: none;">
  <h2>Arrow Event Specifications</h2>
</a>
<p>Developers may find it useful to access logs from the Arrow Events contract. Standard events filters from <code>web3.py</code>, <code>web3.js</code> and <code>ethers.js</code> can be used.</p>
<p>The most relevant events are likely the <code>NewLiabilityCreation</code> and <code>NewLiabilityDestruction</code> events. The rest of the events can be found in the <code>IArrowEvents.json</code> ABI files.</p>
<p>The NewLiabilityCreation and NewLiabilityDestruction events look as follows:</p>
<pre><code><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;ownerAddress&quot;</span><span class="hl-0">: </span><span class="hl-5">address</span><span class="hl-0">, </span><span class="hl-4">// Indexed address of the owner of the new liability</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;optionAddress&quot;</span><span class="hl-0">: </span><span class="hl-5">address</span><span class="hl-0">, </span><span class="hl-4">// Indexed address of the on-chain option contract</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;hashedTicker&quot;</span><span class="hl-0">: </span><span class="hl-5">string</span><span class="hl-0">, </span><span class="hl-4">// Indexed string to indicate a particular asset (&quot;AVAX&quot;, &quot;ETH&quot;, &quot;BTC&quot;, or &quot;LINK&quot;).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;ticker&quot;</span><span class="hl-0">: </span><span class="hl-5">string</span><span class="hl-0"> </span><span class="hl-4">// String to indicate a particular asset (&quot;AVAX&quot;, &quot;ETH&quot;, &quot;BTC&quot;, or &quot;LINK&quot;).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;expiration&quot;</span><span class="hl-0">: </span><span class="hl-5">uint256</span><span class="hl-0">, </span><span class="hl-4">// Date in Unix timestamp. Must be 9:00 PM UTC (e.g. 1643144400 for January 25th, 2022)</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;readableExpiration&quot;</span><span class="hl-0">: </span><span class="hl-5">uint256</span><span class="hl-0">, </span><span class="hl-4">// Date in &quot;MMDDYYYY&quot; format (e.g. &quot;01252022&quot; for January 25th, 2022).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;decimalStrike&quot;</span><span class="hl-0">: </span><span class="hl-5">string</span><span class="hl-0">, </span><span class="hl-4">// String version of the strike that includes the decimal places (e.g. &quot;12.25&quot;).</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;contractType&quot;</span><span class="hl-0">: </span><span class="hl-5">uint256</span><span class="hl-0">, </span><span class="hl-4">// 0 for call, 1 for put, 2 for call spread, and 3 for put spread.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;quantity&quot;</span><span class="hl-0">: </span><span class="hl-5">uint256</span><span class="hl-0">, </span><span class="hl-4">// Number of contracts desired in the order.</span><br/><span class="hl-0">    </span><span class="hl-3">&quot;optionPrice&quot;</span><span class="hl-0">: </span><span class="hl-5">uint256</span><span class="hl-0"> </span><span class="hl-4">// Price paid or received for each of the option contracts.</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
  <h1>Examples</h1>
</a>

<a href="#getting-stablecoin-contract-from-router-contract" id="getting-stablecoin-contract-from-router-contract" style="color: inherit; text-decoration: none;">
  <h2>Getting Stablecoin Contract From Router Contract</h2>
</a>
<p>The code below is an example of how to access contract addresses through the Arrow router contract. The code is available in <code>./examples/get-stablecoin-contract.ts</code> as well.</p>
<pre><code class="language-javascript"><span class="hl-6">import</span><span class="hl-0"> </span><span class="hl-5">arrowsdk</span><span class="hl-0"> </span><span class="hl-6">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../arrow-sdk&#39;</span><br/><br/><span class="hl-7">async</span><span class="hl-0"> </span><span class="hl-7">function</span><span class="hl-0"> </span><span class="hl-8">main</span><span class="hl-0">() {</span><br/><span class="hl-0">    </span><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">version</span><span class="hl-0"> = </span><span class="hl-3">&#39;v3&#39;</span><br/><span class="hl-0">    </span><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">stablecoin</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-5">arrowsdk</span><span class="hl-0">.</span><span class="hl-8">getStablecoinContract</span><span class="hl-0">(</span><span class="hl-5">arrowsdk</span><span class="hl-0">.</span><span class="hl-5">providers</span><span class="hl-0">.</span><span class="hl-5">fuji</span><span class="hl-0">, </span><span class="hl-5">version</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><span class="hl-8">main</span><span class="hl-0">()</span>
</code></pre>

<a href="#submitting-option-order-through-api" id="submitting-option-order-through-api" style="color: inherit; text-decoration: none;">
  <h2>Submitting Option Order Through API</h2>
</a>
<p>The code below is used to place an order on the Arrow platform. There are several steps outlined for this. For the full script, please refer to <code>./examples/place-option-order.ts</code><br><br>Step 1: Prepare the <code>deliverOption()</code> function call parameters. This includes hashing the option parameters and having the user sign the hash.</p>
<pre><code class="language-javascript"><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">deliverOptionParams</span><span class="hl-0">: </span><span class="hl-9">DeliverOptionParams</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-8">prepareDeliverOptionParams</span><span class="hl-0">(</span><span class="hl-5">optionOrderParams</span><span class="hl-0">, </span><span class="hl-5">wallet</span><span class="hl-0">, </span><span class="hl-5">version</span><span class="hl-0">)</span>
</code></pre>
<p>Inside <code>prepareDeliverOptionParams()</code> we can see how the hash and signature are produced</p>
<pre><code class="language-javascript"><span class="hl-4">// Hash and sign the option order parameters for on-chain verification</span><br/><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">hashedValues</span><span class="hl-0"> = </span><span class="hl-5">ethers</span><span class="hl-0">.</span><span class="hl-5">utils</span><span class="hl-0">.</span><span class="hl-8">solidityKeccak256</span><span class="hl-0">(</span><br/><span class="hl-0">    [</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;bool&#39;</span><span class="hl-0">, </span><span class="hl-4">// buy_flag - Boolean to indicate whether this is a buy (true) or sell (false).</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-4">// ticker - String to indicate a particular asset (&quot;AVAX&quot;, &quot;ETH&quot;, &quot;BTC&quot;, or &quot;LINK&quot;).</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;uint256&#39;</span><span class="hl-0">, </span><span class="hl-4">// expiration - Date in Unix timestamp. Must be 9:00 PM UTC (e.g. 1643144400 for January 25th, 2022)</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;uint256&#39;</span><span class="hl-0">, </span><span class="hl-4">// readableExpiration - Date in &quot;MMDDYYYY&quot; format (e.g. &quot;01252022&quot; for January 25th, 2022).</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;uint256&#39;</span><span class="hl-0"> </span><span class="hl-5">or</span><span class="hl-0"> </span><span class="hl-3">&#39;uint256[2]&#39;</span><span class="hl-0">, </span><span class="hl-4">// strike - Ethers BigNumber version of the strike in terms of the stablecoin&#39;s decimals (e.g. ethers.utils.parseUnits(strike, await usdc_e.decimals())).</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0">, </span><span class="hl-4">// decimalStrike - String version of the strike that includes the decimal places (e.g. &quot;12.25&quot;).</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;uint256&#39;</span><span class="hl-0">, </span><span class="hl-4">// contract_type - 0 for call, 1 for put, 2 for call spread, and 3 for put spread.</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;uint256&#39;</span><span class="hl-0">, </span><span class="hl-4">// quantity - Number of contracts desired in the order.</span><br/><span class="hl-0">        </span><span class="hl-3">&#39;uint256&#39;</span><span class="hl-0"> </span><span class="hl-4">// threshold_price - Indication of the price the user is willing to pay (e.g. ethers.utils.parseUnits(priceWillingToPay, await usdc_e.decimals()).toString()).</span><br/><span class="hl-0">    ],</span><br/><span class="hl-0">    [</span><br/><span class="hl-0">        </span><span class="hl-5">buyFlag</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">ticker</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">expiration</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-5">readableExpiration</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-5">ethers</span><span class="hl-0">.</span><span class="hl-5">utils</span><span class="hl-0">.</span><span class="hl-8">parseUnits</span><span class="hl-0">(</span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">decimalStrike</span><span class="hl-0">, </span><span class="hl-5">decimals</span><span class="hl-0">), </span><span class="hl-4">// option.decimalStrike * 10**stablecoinDecimals</span><br/><span class="hl-0">        </span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">decimalStrike</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">contractType</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">quantity</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-5">thresholdPrice</span><br/><span class="hl-0">    ]</span><br/><span class="hl-0">)</span><br/><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">signature</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-5">wallet</span><span class="hl-0">.</span><span class="hl-8">signMessage</span><span class="hl-0">(</span><span class="hl-5">ethers</span><span class="hl-0">.</span><span class="hl-5">utils</span><span class="hl-0">.</span><span class="hl-8">arrayify</span><span class="hl-0">(</span><span class="hl-5">hashedValues</span><span class="hl-0">)) </span><span class="hl-4">// Note that we are signing a message, not a transaction</span>
</code></pre>
<p>Step 2: Approval to option chain proxy.</p>
<p>Because we deal in ERC20s, we require a user to allow the option chain contract to spend their stablecoin with an <code>approve()</code> function call. This must be done before submitting the request to the API to ensure that the transaction will succeed. Since the option chain proxy may not have been deployed yet, we must use <code>CREATE2</code> to compute the address for the option chain contract as follows:</p>
<pre><code class="language-javascript"><span class="hl-4">// Get computed option chain address</span><br/><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">optionChainAddress</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-8">computeOptionChainAddress</span><span class="hl-0">(</span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">ticker</span><span class="hl-0">, </span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">expiration</span><span class="hl-0">, </span><span class="hl-5">version</span><span class="hl-0">)</span><br/><br/><span class="hl-4">// Approval circuit if the order is a &quot;buy&quot; order</span><br/><span class="hl-6">if</span><span class="hl-0"> (</span><span class="hl-5">buyFlag</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">// Get user&#39;s balance of stablecoin</span><br/><span class="hl-0">    </span><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">userBalance</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-5">stablecoin</span><span class="hl-0">.</span><span class="hl-8">balanceOf</span><span class="hl-0">(</span><span class="hl-5">wallet</span><span class="hl-0">.</span><span class="hl-5">address</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-4">// Calculate amount to approve for this order (total = thresholdPrice * quantity)</span><br/><span class="hl-0">    </span><span class="hl-7">const</span><span class="hl-0"> </span><span class="hl-1">amountToApprove</span><span class="hl-0"> = </span><span class="hl-5">ethers</span><span class="hl-0">.</span><span class="hl-5">BigNumber</span><span class="hl-0">.</span><span class="hl-8">from</span><span class="hl-0">(</span><span class="hl-5">thresholdPrice</span><span class="hl-0">).</span><span class="hl-8">mul</span><span class="hl-0">(</span><span class="hl-5">option</span><span class="hl-0">.</span><span class="hl-5">quantity</span><span class="hl-0">)</span><br/><br/><span class="hl-0">    </span><span class="hl-4">// If user&#39;s balance is less than the amount required for the approval, throw an error</span><br/><span class="hl-0">    </span><span class="hl-6">if</span><span class="hl-0"> (</span><span class="hl-5">userBalance</span><span class="hl-0">.</span><span class="hl-8">lt</span><span class="hl-0">(</span><span class="hl-5">amountToApprove</span><span class="hl-0">)) {</span><br/><span class="hl-0">        </span><span class="hl-6">throw</span><span class="hl-0"> </span><span class="hl-7">new</span><span class="hl-0"> </span><span class="hl-9">Error</span><span class="hl-0">(</span><span class="hl-3">&#39;You do not have enough stablecoin to pay for your indicated threshold price.&#39;</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-4">// Get the amount that the option chain proxy is currently approved to spend</span><br/><span class="hl-0">    </span><span class="hl-7">let</span><span class="hl-0"> </span><span class="hl-5">approvedAmount</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-5">stablecoin</span><span class="hl-0">.</span><span class="hl-8">allowance</span><span class="hl-0">(</span><span class="hl-5">wallet</span><span class="hl-0">.</span><span class="hl-5">address</span><span class="hl-0">, </span><span class="hl-5">optionChainAddress</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-4">// If the approved amount is less than the amount required to be approved, ask user to approve the proper amount</span><br/><span class="hl-0">    </span><span class="hl-6">if</span><span class="hl-0"> (</span><span class="hl-5">approvedAmount</span><span class="hl-0">.</span><span class="hl-8">lt</span><span class="hl-0">(</span><span class="hl-5">amountToApprove</span><span class="hl-0">)) {</span><br/><span class="hl-0">        </span><span class="hl-4">// Wait for the approval to be confirmed on-chain</span><br/><span class="hl-0">        </span><span class="hl-6">await</span><span class="hl-0"> (</span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-5">stablecoin</span><span class="hl-0">.</span><span class="hl-8">approve</span><span class="hl-0">(</span><span class="hl-5">optionChainAddress</span><span class="hl-0">, </span><span class="hl-5">amountToApprove</span><span class="hl-0">)).</span><span class="hl-8">wait</span><span class="hl-0">(</span><span class="hl-5">numBlockConfirmations</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-4">// Get the amount that the option chain proxy is approved to spend now</span><br/><span class="hl-0">        </span><span class="hl-5">approvedAmount</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-5">stablecoin</span><span class="hl-0">.</span><span class="hl-8">allowance</span><span class="hl-0">(</span><span class="hl-5">wallet</span><span class="hl-0">.</span><span class="hl-5">address</span><span class="hl-0">, </span><span class="hl-5">optionChainAddress</span><span class="hl-0">)</span><br/><span class="hl-0">        </span><span class="hl-4">// If the newly approved amount is still less than the amount required to be approved, throw and error</span><br/><span class="hl-0">        </span><span class="hl-6">if</span><span class="hl-0"> (</span><span class="hl-5">approvedAmount</span><span class="hl-0">.</span><span class="hl-8">lt</span><span class="hl-0">(</span><span class="hl-5">amountToApprove</span><span class="hl-0">)) {</span><br/><span class="hl-0">            </span><span class="hl-6">throw</span><span class="hl-0"> </span><span class="hl-7">new</span><span class="hl-0"> </span><span class="hl-9">Error</span><span class="hl-0">(</span><span class="hl-3">&#39;Approval to option chain failed.&#39;</span><span class="hl-0">)</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>Step 3: Submit option order request to API.</p>
<p>The <code>tx_hash</code> and <code>execution_price</code> parameters will be populated if the API call is successful. In the case where the API call is unsuccessful, more details are provided by the response from axios, so make sure you use a try-catch block.</p>
<pre><code class="language-javascript"><span class="hl-4">// Submit order to API and get response</span><br/><span class="hl-6">try</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-7">const</span><span class="hl-0"> [</span><span class="hl-1">tx_hash</span><span class="hl-0">, </span><span class="hl-1">execution_price</span><span class="hl-0">] = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-8">submitOptionOrder</span><span class="hl-0">(</span><span class="hl-5">deliverOptionParams</span><span class="hl-0">, </span><span class="hl-5">version</span><span class="hl-0">)</span><br/><span class="hl-0">} </span><span class="hl-6">catch</span><span class="hl-0">(</span><span class="hl-5">err</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">err</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-interface"><a href="interfaces/DeliverOptionParams.html" class="tsd-kind-icon">Deliver<wbr/>Option<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/Option.html" class="tsd-kind-icon">Option</a></li><li class="tsd-kind-interface"><a href="interfaces/OptionOrderParams.html" class="tsd-kind-icon">Option<wbr/>Order<wbr/>Params</a></li><li class="tsd-kind-variable"><a href="modules.html#addresses" class="tsd-kind-icon">addresses</a></li><li class="tsd-kind-variable"><a href="modules.html#bytecodeHashes" class="tsd-kind-icon">bytecode<wbr/>Hashes</a></li><li class="tsd-kind-variable"><a href="modules.html#default" class="tsd-kind-icon">default</a></li><li class="tsd-kind-variable"><a href="modules.html#providers" class="tsd-kind-icon">providers</a></li><li class="tsd-kind-variable"><a href="modules.html#urls" class="tsd-kind-icon">urls</a></li><li class="tsd-kind-function"><a href="modules.html#computeOptionChainAddress" class="tsd-kind-icon">compute<wbr/>Option<wbr/>Chain<wbr/>Address</a></li><li class="tsd-kind-function"><a href="modules.html#estimateOptionPrice" class="tsd-kind-icon">estimate<wbr/>Option<wbr/>Price</a></li><li class="tsd-kind-function"><a href="modules.html#getEventsContract" class="tsd-kind-icon">get<wbr/>Events<wbr/>Contract</a></li><li class="tsd-kind-function"><a href="modules.html#getRegistryContract" class="tsd-kind-icon">get<wbr/>Registry<wbr/>Contract</a></li><li class="tsd-kind-function"><a href="modules.html#getRouterContract" class="tsd-kind-icon">get<wbr/>Router<wbr/>Contract</a></li><li class="tsd-kind-function"><a href="modules.html#getStablecoinContract" class="tsd-kind-icon">get<wbr/>Stablecoin<wbr/>Contract</a></li><li class="tsd-kind-function"><a href="modules.html#prepareDeliverOptionParams" class="tsd-kind-icon">prepare<wbr/>Deliver<wbr/>Option<wbr/>Params</a></li><li class="tsd-kind-function"><a href="modules.html#settleOptions" class="tsd-kind-icon">settle<wbr/>Options</a></li><li class="tsd-kind-function"><a href="modules.html#submitOptionOrder" class="tsd-kind-icon">submit<wbr/>Option<wbr/>Order</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>